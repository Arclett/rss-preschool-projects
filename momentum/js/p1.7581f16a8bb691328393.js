(()=>{"use strict";const e={language:"en",photoSource:"github",elements:["player","time","date","greetings","quotes","weather"],tagsPhoto:"nature",timeOfDayEn:["Good Night","Good Morning","Good Afternoon","Good Evening"],timeOfDayRu:["Доброй ночи","Доброе утро","Добрый день","Добрый вечер"]},t=["player","time","date","greetings","quotes","weather"],n={player:"Музыка",time:"Время",date:"Дата",greetings:"Приветствие",quotes:"Цитата",weather:"Погода"},o=new Map([["Музыка","player"],["Время","time"],["Дата","date"],["Приветствие","greetings"],["Цитата","quotes"],["Погода","weather"]]),c=function(){t.forEach((function(t){e.elements.includes(t)?(document.querySelector(`.${t}`).classList.remove("hidden"),document.querySelector(`.${t}`).classList.add("visible")):(document.querySelector(`.${t}`).classList.remove("visible"),document.querySelector(`.${t}`).classList.add("hidden"))}))},s=function(){t.forEach((function(t){e.elements.includes(t)?document.querySelector(`.${t}-inp`).checked=!0:document.querySelector(`.${t}-inp`).checked=!1}))},r=document.querySelectorAll(".elem-label");let a=e.language;const l=function(){a=e.language,document.querySelector(".username").placeholder="en"===a?"[Enter name]":"[Введите имя]",document.querySelector(".city").placeholder="en"===a?"[Enter city]":"[Введите город]",[...r].forEach((function(e){if("en"===a){const t=e.textContent,n=o.get(t)||e.textContent;e.textContent=`${n.replace(n[0],n[0].toUpperCase())}`}else{const t=e.textContent.toLowerCase();e.textContent=`${n[t]}`}})),document.querySelector(".current-tags").textContent="en"===a?"Tag:":"Тег:",document.querySelector(".add-tags").value="en"===a?"Add tag":"Добавить тег",document.querySelector(".en-set").textContent="en"===a?"English":"Английский",document.querySelector(".ru-set").textContent="en"===a?"Russian":"Русский"};[...document.querySelectorAll(".element")].forEach((t=>t.addEventListener("click",(function(){if(t.checked){const n=e.elements.filter((function(e){if(e!==t)return e}));e.elements=n}}))));const u=document.querySelector(".time"),i=document.querySelector(".date"),d=document.querySelector(".greeting"),m=document.querySelector(".username"),g=function(){const t=(new Date).getHours();return("en"===a?e.timeOfDayEn:e.timeOfDayRu)[Math.floor(t/6)]},y=function(){const e=new Date,t=e.toLocaleTimeString(),n=e.toLocaleDateString("en"===a?"en-US":"ru-RU",{weekday:"long",month:"long",day:"numeric"});u.textContent=`${t}`,i.textContent=`${n.slice()}`,d.textContent=`${g()},`,setTimeout(y,1e3)},h=document.querySelector("body");let p,f;async function S(){let t;"github"===e.photoSource?t=function(){let t;return p=g(),t="en"===a?e.timeOfDayEn.indexOf(p):e.timeOfDayRu.indexOf(p),`https://raw.githubusercontent.com/Arclett/stage1-tasks/assets/images/${["night","morning","afternoon","evening"][t]}/${f.toString().padStart(2,"0")}.jpg`}():("flickr"===e.photoSource||"unplash"===e.photoSource)&&(t=await async function(){if("unplash"===e.photoSource){const t=`https://api.unsplash.com/photos/random?orientation=landscape&query=${e.tagsPhoto}&client_id=n--SK77UqCI2ztzPFUUgJKS4GEwIgThxk3MK1623O5c`,n=await fetch(t);return(await n.json()).urls.regular}if("flickr"===e.photoSource){const t=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=2742857064cb37d47617e3ebf4edc0fc&tags=${e.tagsPhoto}&extras=url_l&format=json&nojsoncallback=1`,n=await fetch(t);return(await n.json()).photos.photo[Math.floor(100*Math.random())+1].url_l}}());const n=new Image;n.src=`${t}`,n.addEventListener("load",(function(){h.style.backgroundImage=`url('${t}')`}))}f=Math.floor(20*Math.random())+1;const q=document.querySelector(".weather-icon"),v=document.querySelector(".temperature"),$=document.querySelector(".wind"),L=document.querySelector(".humidity"),x=document.querySelector(".weather-error"),k=document.querySelector(".weather-description"),w=document.querySelector(".city");async function E(){if(w.value){const e=`https://api.openweathermap.org/data/2.5/weather?q=${w.value}&lang=${a}&appid=5f83aa5f50e6d674b9b8a3881a9f7bac&units=metric`,t=await fetch(e),n=await t.json();"404"===n.cod?(x.textContent=`${"en"===a?"Error! City not found for":"Ошибка! Не найден город"} "${w.value}"`,q.className="weather-icon owf",v.textContent="",k.textContent="",$.textContent="",L.textContent=""):(x.textContent="",q.className="weather-icon owf",q.classList.add(`owf-${n.weather[0].id}`),v.textContent=`${Math.round(n.main.temp)}°C`,k.textContent=`${n.weather[0].description}`,$.textContent=`${"en"===a?"Wind speed":"Скорость ветра"}: ${Math.round(n.wind.speed)} ${"en"===a?"m/s":"м/с"}`,L.textContent=`${"en"===a?"Humidity":"Влажность"}: ${n.main.humidity}`)}}const C=document.querySelector(".quote"),b=document.querySelector(".author");let I,O;async function M(){const e="en"===a?"dataEn.json":"dataRu.json",t=await fetch(e),n=await t.json();O=n.length,void 0===I&&(I=Math.round(Math.random()*(O-1))),C.textContent=`${n[I].text}`,b.textContent=`${n[I].author}`}const T=[{title:"Aqua Caelestis",src:"../assets/sounds/Aqua Caelestis.mp3",duration:"0:39"},{title:"Ennio Morricone",src:"../assets/sounds/Ennio Morricone.mp3",duration:"1:37"},{title:"River Flows In You",src:"../assets/sounds/River Flows In You.mp3",duration:"1:37"},{title:"Summer Wind",src:"../assets/sounds/Summer Wind.mp3",duration:"1:50"}],D=document.querySelector(".song-name"),j=document.querySelector(".play-list");let A=!1,P=0;const R=document.querySelector(".length"),U=(document.querySelector(".play"),document.querySelector(".timeline")),W=new Audio,G=document.querySelector(".player-icon:nth-child(2)"),_=function(e){return new Date(1e3*e).toISOString().slice(15,19)},F=function(){const e=N();!1===A?(W.src=`../assets/sounds/${D.textContent}.mp3`,W.currentTime=P,W.play(),H(),G.classList.remove("play"),G.classList.add("pause"),X(),document.querySelector(`.button-${e+1}`).style.background='url("../assets/svg/pauseside.svg") no-repeat',A=!0):(W.pause(),P=W.currentTime,G.classList.add("play"),G.classList.remove("pause"),X(),document.querySelector(`.button-${e+1}`).style.background='url("../assets/svg/play(1).svg") no-repeat',A=!1)},K=function(){A=!1,P=0,F()},N=function(){return T.map((function(e){return e.title})).indexOf(D.textContent)},z=function(){const e=N();e===T.length-1?(D.textContent=`${T[0].title}`,K()):(D.textContent=`${T[e+1].title}`,K())},H=function(){const e=N();T.forEach((function(e){document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-name`).style.color="lightgrey",document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-name`).style.fontWeight="normal"})),document.querySelector(`li:nth-child(${e+1}) .play-list-name`).style.color="white",document.querySelector(`li:nth-child(${e+1}) .play-list-name`).style.fontWeight="bold"},X=function(){T.forEach((function(e){document.querySelector(`.button-${T.indexOf(e)+1}`).style.background='url("../assets/svg/play(1).svg") no-repeat'}))},Y=document.querySelector(".option"),J=document.querySelector(".option-burger"),B=document.querySelector(".add-tags"),Q=document.querySelector(".tag-input"),V=document.querySelector(".current-tags-span"),Z=document.querySelector(".slide-next"),ee=document.querySelector(".slide-prev"),te=document.querySelector(".change-quote"),ne=document.querySelector(".volume-button"),oe=document.querySelector(".volume-slider"),ce=document.querySelector(".song-wrapper"),se=document.querySelector(".play-next"),re=document.querySelector(".play-prev"),ae=document.querySelector(".ru"),le=document.querySelector(".en"),ue=document.querySelector(".github"),ie=document.querySelector(".unplash"),de=document.querySelector(".flickr");function me(){localStorage.setItem("name",m.value),localStorage.setItem("city",w.value),localStorage.setItem("settings-elements",e.elements),localStorage.setItem("settings-lang",e.language),localStorage.setItem("settings-photo-source",e.photoSource),localStorage.setItem("settings-tags-photo",e.tagsPhoto)}y(),window.addEventListener("beforeunload",me),m.addEventListener("keypress",(function(e){"Enter"===e.key&&(me(),m.blur())})),window.addEventListener("load",(function(){localStorage.getItem("name")&&(m.value=localStorage.getItem("name")),localStorage.getItem("city")&&(w.value=localStorage.getItem("city"),E()),localStorage.getItem("settings-elements")&&(e.elements=localStorage.getItem("settings-elements").split(","),c(),s()),localStorage.getItem("settings-lang")&&(e.language=localStorage.getItem("settings-lang"),document.querySelector(`.${localStorage.getItem("settings-lang")}`).checked=!0,l(),M()),localStorage.getItem("settings-tags-photo",e.tagsPhoto)&&(e.tagsPhoto=localStorage.getItem("settings-tags-photo"),V.textContent=localStorage.getItem("settings-tags-photo"),he()),localStorage.getItem("settings-photo-source")&&(e.photoSource=localStorage.getItem("settings-photo-source"),document.querySelector(`.${localStorage.getItem("settings-photo-source")}`).checked=!0,S(),ye())})),S(),Z.addEventListener("click",(function(){"github"===e.photoSource?f<20?(f++,S()):(f=0,S()):S()})),ee.addEventListener("click",(function(){"github"===e.photoSource?f>0?(f--,S()):(f=20,S()):S()})),E(),w.addEventListener("change",E),M(),te.addEventListener("click",(function(){let e=Math.round(Math.random()*(O-1));for(;I===e;)e=Math.round(Math.random()*(O-1));I=e,M()})),T.forEach((function(e){const t=document.createElement("li");t.classList.add("play-item"),j.append(t);const n=document.createElement("button");n.classList.add("play-list-button",`button-${T.indexOf(e)+1}`);const o=document.createElement("span");o.classList.add("play-list-name"),document.querySelector(`li:nth-child(${T.indexOf(e)+1})`).append(n),document.querySelector(`li:nth-child(${T.indexOf(e)+1})`).append(o),document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-name`).textContent=`${e.title}`,document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-name`).addEventListener("click",(function(){D.textContent=`${e.title}`,R.textContent=`${e.duration}`,K()})),document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-button`).addEventListener("click",(function(){!function(e){const t=N();!1===A?e.classList.contains(`button-${t+1}`)?(W.src=`../assets/sounds/${D.textContent}.mp3`,W.currentTime=P,W.play(),H(),G.classList.remove("play"),G.classList.add("pause"),document.querySelector(`.button-${t+1}`).style.background='url("../assets/svg/pauseside.svg") no-repeat',A=!0):(X(),D.textContent=`${T[e.classList[1].slice(-1)-1].title}`,W.src=`../assets/sounds/${T[e.classList[1].slice(-1)-1].title}.mp3`,W.currentTime=P,W.play(),H(),G.classList.remove("play"),G.classList.add("pause"),document.querySelector(`.button-${e.classList[1].slice(-1)}`).style.background='url("../assets/svg/pauseside.svg") no-repeat',A=!0):e.classList.contains(`button-${t+1}`)?(W.pause(),P=W.currentTime,A=!1,G.classList.add("play"),G.classList.remove("pause"),document.querySelector(`.button-${t+1}`).style.background='url("../assets/svg/play(1).svg") no-repeat'):(W.pause(),X(),D.textContent=`${T[e.classList[1].slice(-1)-1].title}`,W.src=`../assets/sounds/${T[e.classList[1].slice(-1)-1].title}.mp3`,W.currentTime=0,W.play(),H(),e.style.background='url("../assets/svg/pauseside.svg") no-repeat',G.classList.remove("play"),G.classList.add("pause"),A=!0)}(document.querySelector(`li:nth-child(${T.indexOf(e)+1}) .play-list-button`))}))})),""===D.textContent&&(D.textContent=`${T[0].title}`),R.textContent=`${T[0].duration}`,document.querySelector("li:nth-child(1) .play-list-name").style.color="white",document.querySelector("li:nth-child(1) .play-list-name").style.fontWeight="bold",W.addEventListener("loadeddata",(function(){const e=Math.floor(W.duration);R.textContent=`${_(e)}`})),G.addEventListener("click",F),U.addEventListener("click",(e=>{const t=window.getComputedStyle(U).width,n=e.offsetX/parseInt(t)*W.duration;W.currentTime=n})),setInterval((()=>{document.querySelector(".progress").style.width=W.currentTime/W.duration*100+"%",document.querySelector(".current").textContent=_(W.currentTime)}),500),ne.addEventListener("mouseover",(function(){oe.style.display="block"})),oe.addEventListener("mouseleave",(function(){oe.style.display="none"})),ce.addEventListener("mouseleave",(function(){oe.style.display="none"}));const ge=document.querySelector(".volume-slider");ge.addEventListener("click",(e=>{const t=window.getComputedStyle(ge).width,n=e.offsetX/parseInt(t);W.volume=n,document.querySelector(".volume-percentage").style.width=100*n+"%"})),ne.addEventListener("click",(function(){W.muted=!W.muted,W.muted?ne.style.backgroundImage='url("../assets/svg/mute.svg")':ne.style.backgroundImage='url("../assets/svg/volume.svg")'})),se.addEventListener("click",z),re.addEventListener("click",(function(){const e=N();0===e?(D.textContent=`${T[T.length-1].title}`,K()):(D.textContent=`${T[e-1].title}`,K())})),W.addEventListener("ended",z),c(),s(),e.elements.forEach((function(t){const n=document.querySelector(`.${t}-inp`);n.addEventListener("click",(function(){if(n.checked)e.elements.push(`${n.getAttribute("name")}`),n.checked=!0,c();else{let t=[];e.elements.forEach((function(e){n.classList.contains(`${e}-inp`)||t.push(e)})),e.elements=t,c()}}))})),le.addEventListener("click",(function(){le.checked&&(e.language="en"),l(),E(),M()})),ae.addEventListener("click",(function(){ae.checked&&(e.language="ru"),l(),E(),M()})),ue.addEventListener("click",(function(){ue.checked&&(e.photoSource="github"),S(),ye()})),ie.addEventListener("click",(function(){ie.checked&&(e.photoSource="unplash"),S(),ye()})),de.addEventListener("click",(function(){de.checked&&(e.photoSource="flickr"),S(),ye()}));const ye=function(){ue.checked?document.querySelector(".tags").style.display="none":document.querySelector(".tags").style.display="block"};ye();const he=function(){V.textContent=e.tagsPhoto};B.addEventListener("click",(function(){V.textContent=Q.value,e.tagsPhoto=Q.value.toLowerCase(),S()})),Y.addEventListener("click",(function(){J.classList.toggle("invis")})),J.addEventListener("mouseleave",(function(){J.classList.add("invis")}))})();